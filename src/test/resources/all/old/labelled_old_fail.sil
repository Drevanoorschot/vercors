field tk: Ref
field f: Int

method main() {
  var m: Ref
  m := new(f)
  m.f := 15

  statelabel initial

  m.f := 3
  inhale acc(m.tk, write)

  exhale m.f == 3 && old[initial](m.f) == 15
  assert perm(m.tk) == write
  //:: ExpectedOutput(assert.failed:assertion.false)
  assert old[initial](perm(m.tk)) == write
}

method main2() {
  var m: Ref
  m := new(f)

  m.f := 15

  statelabel initial

  m.f := 3
  inhale acc(m.tk, write)

  exhale m.f == 3 && old[initial](m.f) == 15
  exhale acc(m.f)
  //:: ExpectedOutput(exhale.failed:assertion.false)
  exhale old[initial](m.f) == 3
}
