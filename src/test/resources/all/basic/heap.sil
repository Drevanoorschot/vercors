
var f: Ref

// test aliasing of heap values with other objects
method t1() {
    var a: Ref
    var c: Ref

    c := new()

    assume a != null
    set_f(a, c)

    inhale acc(a.f, write)

    assert c.f != c

    //:: ExpectedError(assert.failed:assertion.false)
    assert a.f != c
}

method set_f(monitor: Ref, value: Ref)
  requires monitor != null && value != null
{
  inhale acc(monitor.f, write)
  monitor.f := value
  exhale acc(monitor.f, write)
}

method t2(r: Ref) {
  if (r != null) {
    assert perm(r.f) == none
  } else {
    //:: ExpectedError(assert.failed:receiver.null)
    assert perm(r.f) == none
  }
}
