
var f: Int

domain Test {
    function func(a: Int): Int
}

method t1_a(this: Ref)
{
    //:: ExpectedError(assignment.failed:receiver.null)
    //:: ExpectedError(assignment.failed:insufficient.permission)
    //:: MissingError(assignment.failed:insufficient.permission, /Silicon/issue/34/)
    var i: Int := this.f
}

method t1_b(this: Ref)
{
    assume this != null
    //:: ExpectedError(insufficient.permission)
    var i: Int := this.f
}

method t2_a(this: Ref)
{
    //:: ExpectedError(assignment.failed:receiver.null)
    //:: ExpectedError(assignment.failed:insufficient.permission)
    //:: MissingError(assignment.failed:insufficient.permission, /Silicon/issue/34/)
    var i: Int := func(this.f)
}

method t2_b(this: Ref)
{
    assume this != null
    //:: ExpectedError(insufficient.permission)
    var i: Int := func(this.f)
}

method t3(this: Ref, p2: Perm)
{
    //:: ExpectedError(invalid.perm.multiplication)
    //:: MissingError(invalid.perm.multiplication, /Silicon/issue/31/)
    var p: Perm := epsilon * p2
}

method t4_a(this: Ref)
{
    //:: ExpectedError(assignment.failed:receiver.null)
    //:: ExpectedError(assignment.failed:insufficient.permission)
    //:: MissingError(assignment.failed:insufficient.permission, /Silicon/issue/34/)
    this.f := 1
}

method t4_b(this: Ref)
{
    assume this != null
    //:: ExpectedError(insufficient.permission)
    this.f := 1
}
