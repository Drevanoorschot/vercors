var f: Int
var g: Int

method test06(x: Ref) {
  package acc(x.f, write) --* acc(x.f, write)
  package acc(x.f, write) --* acc(x.f, 1/2)
}

method test07(x: Ref) {
  //:: ExpectedError(package.failed:insufficient.permission)
  package acc(x.f, 1/2) --* acc(x.f, write)
}

method test01(x: Ref)
  requires acc(x.f, write)
{
  x.f := 0
  //:: ExpectedError(package.failed:assertion.false)
  package acc(x.f, 1/2) --* (acc(x.f, 1/2) && x.f == 0)
}

method test09(x: Ref)
  requires acc(x.f, write)
{
  x.f := 0
  package acc(x.f, 1/2) --* (acc(x.f, write) && x.f == 0)
  assert acc(x.f, 1/2)
  //:: ExpectedError(assert.failed:insufficient.permission)
  assert acc(x.f, 2/3)
}

method test08(x: Ref)
  requires acc(x.f, write)
{
  x.f := 0
  package true --* (acc(x.f, 1/3) && x.f == 0)
}

method test03(x: Ref)
  requires acc(x.f, write)
{
  x.f := 1
  //:: ExpectedError(package.failed:assertion.false)
  package acc(x.f, 1/2) --* (acc(x.f, write) && x.f == 0)
}

method test04(x: Ref)
  requires acc(x.f, write)
{
  x.f := 1
  package (acc(x.f, 1/2) && x.f == 0) --* (acc(x.f, 1/2) && x.f == 0)
}

method test05(x: Ref)
  requires acc(x.f, 1/2) && x.f == 1
{
  //:: ExpectedError(package.failed:assertion.false)
  package (acc(x.f, 1/2) && x.f == 0) --* false
}

method test10(x: Ref)
  requires acc(x.f, write)
{
  x.f := 1

  package true --* (acc(x.f, write) && x.f == 1)
  package (acc(x.g, write) && x.g == 1) --* (acc(x.g, write) && x.g == 1)
}

method test11(x: Ref)
  requires acc(x.f, write)
  requires acc(x.g, write)
{
  x.f := 1

  package
    (acc(x.g, write) && x.g == 1)
      --*
    (acc(x.g, write) && x.g == 1 && acc(x.f, write) && x.f == 1)
}
